const crypto = require('crypto');

function sha1(data)
{
	var sha1 = crypto.createHash('sha1');
	sha1.update(data);
	return sha1.digest();
}

module.exports = {
	mysql_native_password: {
		name: "mysql_native_password",
		response: function(password, data)
		{
			var phash = sha1(password);
			var dhash = sha1(phash);
			
			dhash = sha1(Buffer.concat([data.slice(0, 20), dhash], 20 + dhash.length));
			
			for (var i = 0; i < phash.length; i++)
				phash[i] ^= dhash[i];
			
			return phash;
		},
		no_password: function(data)
		{
			return [];
		},
		more_data: function(password, previous_data, previous_response, data)
		{
			return [];
		}
	}
};
